
nor=getTitle();
run("Duplicate...", "title=" + nor + "-norm duplicate");
newmin=0;
newmean=4000;
for (i = 1; i <= nSlices; i++) {
    setSlice(i);
    getStatistics(area, mean, min, max, std, histogram);
    fact=4000/mean;   
      
   
    run("Multiply...", "value=" + fact+ " slice");
       
 
}

    a=getTitle(); // your stack

run("Z Project...", "projection=[Average Intensity]");
b=getTitle();
imageCalculator("Subtract create 32-bit stack", a,b);


or=getTitle();
//Suppress stripes in FFT Domain 
setBatchMode(true);
    stack = getImageID;
    newImage("FFT Movie of "+getTitle, "32-bit", getWidth, getHeight, nSlices);
    movie = getImageID;
    for (i=1; i<=nSlices; i++) {
       showProgress(i, nSlices);
      selectImage(stack);
       
      setSlice(i);
       
       run("FFT");
     //makeOval(326, 350, 350, 324);
  // setBackgroundColor(0, 0, 0);
   // run("Clear Outside");
    // makeRectangle(510, 0, 6, 1024);
     //makeRectangle(510, 0, 4, 510);
     //run("Clear", "slice");
     //makeRectangle(510, 530, 4, 510);
     makeRectangle(1014, 0, 15, 2048);
       run("Clear", "slice");
       //makeRectangle(0, 510, 1024, 6);
      //run("Clear Outside", "slice");
       run("Inverse FFT");
     
   
       run("Copy");
      //C:\Users\Public\Desktop\Fiji
       selectImage(movie);
       setSlice(i);
       run("Paste");
    }
    setBatchMode(false); 
    

   // run("Convolve...", "text1=[0.0018632 0.0035231 0.0042471 0.0039132 0.0027824 0.0013169 -3.0044E-5 -9.4266E-4 -0.0012617 -9.4266E-4 -3.0044E-5 0.0013169 0.0027824 0.0039132 0.0042471 0.0035231 0.0018632\n0.0035231 0.0042618 0.0035136 0.0015573 -9.4266E-4 -0.0032885 -0.0050301 -0.0060344 -0.0063536 -0.0060344 -0.0050301 -0.0032885 -9.4266E-4 0.0015573 0.0035136 0.0042618 0.0035231\n0.0042471 0.0035136 0.0010665 -0.0022554 -0.005371 -0.0075052 -0.0085008 -0.0087372 -0.0087375 -0.0087372 -0.0085008 -0.0075052 -0.005371 -0.0022554 0.0010665 0.0035136 0.0042471\n0.0039132 0.0015573 -0.0022554 -0.0060344 -0.0083542 -0.0085991 -0.0072552 -0.0055811 -0.0048473 -0.0055811 -0.0072552 -0.0085991 -0.0083542 -0.0060344 -0.0022554 0.0015573 0.0039132\n0.0027824 -9.4266E-4 -0.005371 -0.0083542 -0.0082497 -0.0048473 4.1305E-4 0.0050909 0.0069497 0.0050909 4.1305E-4 -0.0048473 -0.0082497 -0.0083542 -0.005371 -9.4266E-4 0.0027824\n0.0013169 -0.0032885 -0.0075052 -0.0085991 -0.0048473 0.0033873 0.013546 0.021874 0.025084 0.021874 0.013546 0.0033873 -0.0048473 -0.0085991 -0.0075052 -0.0032885 0.0013169\n-3.0044E-5 -0.0050301 -0.0085008 -0.0072552 4.1305E-4 0.013546 0.028528 0.040394 0.044903 0.040394 0.028528 0.013546 4.1305E-4 -0.0072552 -0.0085008 -0.0050301 -3.0044E-5\n-9.4266E-4 -0.0060344 -0.0087372 -0.0055811 0.0050909 0.021874 0.040394 0.054835 0.060288 0.054835 0.040394 0.021874 0.0050909 -0.0055811 -0.0087372 -0.0060344 -9.4266E-4\n-0.0012617 -0.0063536 -0.0087375 -0.0048473 0.0069497 0.025084 0.044903 0.060288 0.066093 0.060288 0.044903 0.025084 0.0069497 -0.0048473 -0.0087375 -0.0063536 -0.0012617\n-9.4266E-4 -0.0060344 -0.0087372 -0.0055811 0.0050909 0.021874 0.040394 0.054835 0.060288 0.054835 0.040394 0.021874 0.0050909 -0.0055811 -0.0087372 -0.0060344 -9.4266E-4\n-3.0044E-5 -0.0050301 -0.0085008 -0.0072552 4.1305E-4 0.013546 0.028528 0.040394 0.044903 0.040394 0.028528 0.013546 4.1305E-4 -0.0072552 -0.0085008 -0.0050301 -3.0044E-5\n0.0013169 -0.0032885 -0.0075052 -0.0085991 -0.0048473 0.0033873 0.013546 0.021874 0.025084 0.021874 0.013546 0.0033873 -0.0048473 -0.0085991 -0.0075052 -0.0032885 0.0013169\n0.0027824 -9.4266E-4 -0.005371 -0.0083542 -0.0082497 -0.0048473 4.1305E-4 0.0050909 0.0069497 0.0050909 4.1305E-4 -0.0048473 -0.0082497 -0.0083542 -0.005371 -9.4266E-4 0.0027824\n0.0039132 0.0015573 -0.0022554 -0.0060344 -0.0083542 -0.0085991 -0.0072552 -0.0055811 -0.0048473 -0.0055811 -0.0072552 -0.0085991 -0.0083542 -0.0060344 -0.0022554 0.0015573 0.0039132\n0.0042471 0.0035136 0.0010665 -0.0022554 -0.005371 -0.0075052 -0.0085008 -0.0087372 -0.0087375 -0.0087372 -0.0085008 -0.0075052 -0.005371 -0.0022554 0.0010665 0.0035136 0.0042471\n0.0035231 0.0042618 0.0035136 0.0015573 -9.4266E-4 -0.0032885 -0.0050301 -0.0060344 -0.0063536 -0.0060344 -0.0050301 -0.0032885 -9.4266E-4 0.0015573 0.0035136 0.0042618 0.0035231\n0.0018632 0.0035231 0.0042471 0.0039132 0.0027824 0.0013169 -3.0044E-5 -9.4266E-4 -0.0012617 -9.4266E-4 -3.0044E-5 0.0013169 0.0027824 0.0039132 0.0042471 0.0035231 0.0018632\n] normalize stack");
   // run("Convolve...", "text1=[0.0322 0.0232 -7.0E-4 -0.0254 -0.0411 -0.0461 -0.0411 -0.0254 -7.0E-4 0.0232 0.0322\n0.0232 -0.0101 -0.0461 -0.0644 -0.0649 -0.0622 -0.0649 -0.0644 -0.0461 -0.0101 0.0232\n-7.0E-4 -0.0461 -0.0661 -0.0418 0.0038 0.0264 0.0038 -0.0418 -0.0661 -0.0461 -7.0E-4\n-0.0254 -0.0644 -0.0418 0.0534 0.1663 0.2166 0.1663 0.0534 -0.0418 -0.0644 -0.0254\n-0.0411 -0.0649 0.0038 0.1663 0.3402 0.4151 0.3402 0.1663 0.0038 -0.0649 -0.0411\n-0.0461 -0.0622 0.0264 0.2166 0.4151 0.5 0.4151 0.2166 0.0264 -0.0622 -0.0461\n-0.0411 -0.0649 0.0038 0.1663 0.3402 0.4151 0.3402 0.1663 0.0038 -0.0649 -0.0411\n-0.0254 -0.0644 -0.0418 0.0534 0.1663 0.2166 0.1663 0.0534 -0.0418 -0.0644 -0.0254\n-7.0E-4 -0.0461 -0.0661 -0.0418 0.0038 0.0264 0.0038 -0.0418 -0.0661 -0.0461 -7.0E-4\n0.0232 -0.0101 -0.0461 -0.0644 -0.0649 -0.0622 -0.0649 -0.0644 -0.0461 -0.0101 0.0232\n0.0322 0.0232 -7.0E-4 -0.0254 -0.0411 -0.0461 -0.0411 -0.0254 -7.0E-4 0.0232 0.0322\n] normalize");
    
    
  // run("Enhance Contrast", "saturated=0.35");
// find maxima
// //   d=getTitle(); 
 // input = getImageID();
 // m = nSlices();
 //   run("Clear Results");
 // for (i=1; i<=m; i++) {
 // 	showProgress(i, m);
    // selectImage(input);
    // setSlice(i);
     // run("Find Maxima...", "noise=13 output=[Point Selection] exclude");
    // n=0;
    // type = selectionType();
    //print(type);
     // if (type==-1)
         //        n=0;   
      // else 
      // {getSelectionCoordinates(x, y);
        // n = x.length; }    
     //print(n);
        // run("Select None");
        //setSlice(i);
        // run("Invert", "slice");
      // run("Find Maxima...", "noise=13 output=[Point Selection] exclude");  
      // n2=0;
   //run("Find Maxima...", "noise=10 output=[Point Selection]exclude light");
     // type = selectionType();
    //print(type);
     // if (type==-1)
         //        n2=0;   
      // else 
     // { getSelectionCoordinates(x, y);
        // n2 = x.length;
     // }
     //print(n2);
            
     // Nall=n+n2;
     // print(n);
     // print(n2);
     // print(Nall);
     //run("Restore Selection");
      // getSelectionCoordinates(x, y);
       
      // run("Select None");
      // setResult("Count", nResults,  Nall);
      // run("Invert", "slice");
       
 // } 

